--- # Build an Apache Web Server
- hosts: apacheweb
  user: test
  sudo: yes
  connection: ssh 
  gather_facts: yes
  vars: 
    apache_pkg: httpd
    distribution: redhat
    apache_version: 2.4
    apache_dir: /var/www/sample
    apache_fqdn: ansiblenode1.example.local
  tasks: 
  - name: Install the Web Server Pkg
    yum: pkg=httpd state=latest
  - name: Create the web server dir.
    file: path=/var/www/sample state=directory mode=644
  - name: Copy the apache conf. file to remote host
    copy: src=files/httpd.conf.template dest=/etc/httpd/conf/httpd.conf owner=root group=root mode=644
  - name: Create the VHOST.D dir. on the remote host
    file: path=/etc/httpd/vhost.d state=directory mode=644
  - name: Copy and utar the source for the site
    unarchive: src=files/sitecode.tar.gz dest=/var/www/sample
  - name: Copy the default vhost conf. file
    copy: src=files/default.conf.template dest=/etc/httpd/vhost.d/default.conf owner=root group=root mode=644
  - name: Start the web server
    service: name=httpd state=started
  - name: Test the web server 
    shell: curl http://ansiblenode1.example.com
    register: result
  - name: DisplayResult
    debug: var=result   
    
